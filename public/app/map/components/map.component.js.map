{"version":3,"sources":["../../src/app/map/components/map.component.ts"],"names":[],"mappings":"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","file":"map.component.js","sourcesContent":["import {Component, OnInit} from '@angular/core';\r\nimport {Location} from \"../models/location\";\r\nimport { MyMarker } from '../models/marker';\r\nimport { TrackingService } from \"../../services/TrackingService\";\r\nimport {AgmCoreModule, LatLngBounds, MapsAPILoader, LatLng} from '@agm/core';\r\nimport $ from 'jquery';\r\n\r\ndeclare var google: any;\r\n@Component({\r\n    selector: 'map',\r\n    templateUrl: './app/map/components/map.component.html',\r\n    styleUrls: ['./app/map/components/map.css'],\r\n})\r\n\r\nexport class MapComponent implements OnInit {\r\n    title: string = 'My first AGM project';\r\n    lat: number = 10.820751;\r\n    lng: number = 106.630894;\r\n    mapDraggable: boolean;\r\n    private internalInterval = null;\r\n    constructor(private trackingService: TrackingService, private _mapsAPILoader: MapsAPILoader) { };\r\n    onClick($event) {\r\n        let latd = $event.coords.lat;\r\n        let long = $event.coords.lng;\r\n    };\r\n    allMarkers : any;\r\n    lastPoint : Location;\r\n    ngAfterViewInit() {\r\n        let _this = this;\r\n        this._mapsAPILoader.load().then(() => {\r\n            // _this.mapBounds = new google.maps.LatLngBounds();\r\n            // _this.mapBounds.extend(new google.maps.LatLng({\"lat\" : _this.lat, \"lng\" : _this.lng}));\r\n        });\r\n    }\r\n    ngOnInit(): void {\r\n        this.requestLocation();\r\n\r\n    };\r\n    mapBounds : LatLngBounds;\r\n    requestLocation() {\r\n        let _this = this;\r\n        this.trackingService.getLocations(this.trackingService.urlLocation, this.lastPoint).\r\n        then(function(locationObj) {\r\n            // console.log(markers.length, 'location markers');\r\n            if (_this.allMarkers === undefined) {\r\n                _this.allMarkers = locationObj.markers;\r\n            } else {\r\n                var keys = Object.keys(locationObj.markers);\r\n                for (var i = 0; i < keys.length; i++) {\r\n                    if (_this.allMarkers[keys[i]] !== undefined) {\r\n                        _this.allMarkers[keys[i]].locations = _this.allMarkers[keys[i]].locations\r\n                            .concat(locationObj.markers[keys[i]].locations);\r\n                    }\r\n                }\r\n            }\r\n            _this.lastPoint = locationObj.lastPoint;\r\n            if (_this.internalInterval == null) {\r\n                _this.fetchMarkers(_this);\r\n            }\r\n        }, function(error) {});\r\n    }\r\n    fetchMarkers(context) {\r\n        //handler to markers\r\n        let _this = context;\r\n        _this.internalInterval = setInterval(function(){\r\n            let keys = Object.keys(_this.allMarkers);\r\n            for (let i = 0; i < keys.length; i++) {\r\n                let marker = _this.allMarkers[keys[i]];\r\n                _this.handleLocation(marker, _this);\r\n            }\r\n\r\n        }, 2000);\r\n    };\r\n    handleLocation(marker : MyMarker, context) : void {\r\n        /** handle for location */\r\n        if (context.mapBounds === undefined) {\r\n            context.mapBounds = new google.maps.LatLngBounds();\r\n        }\r\n        if (marker.locations.length > 1) {\r\n            let lt : Location = marker.locations.shift();\r\n            marker.currentLocation = lt;\r\n            let coord = new google.maps.LatLng({\"lat\" : lt.lat, \"lng\" : lt.lng});\r\n            if (context.mapBounds !== undefined ) {\r\n                    context.mapBounds.extend(coord);\r\n                    console.log(context.mapBounds, 'context.mapBounds');\r\n            }\r\n        } else {\r\n            context.requestLocation();\r\n        }\r\n    };\r\n    log(value) {\r\n        console.log(value);\r\n    }\r\n    toArray() {\r\n        if (this.allMarkers != null && this.allMarkers !== undefined) {\r\n            var keys = Object.keys(this.allMarkers);\r\n            console.log(this.allMarkers, 'to aray');\r\n            var arrs = [];\r\n            for (let i = 0; i < keys.length; i++) {\r\n                let temp = this.allMarkers[keys[i]];\r\n                arrs.push(temp);\r\n            }\r\n            return arrs;\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n    onMapReady($event) {\r\n        console.log($event, 'map event');\r\n        if (this.mapBounds !== undefined) {\r\n            //google.map.fitBounds(this.mapBounds);\r\n        }\r\n        let height = $(window).height() - 120;\r\n        $('agm-map').css({\"height\":height + \"px\"});\r\n\r\n    }\r\n}\r\n\r\n// create new class to handle all change of marker called cluster\r\n// each changing literal, market will be change current location so that their position on map will be changed"],"sourceRoot":"/src"}