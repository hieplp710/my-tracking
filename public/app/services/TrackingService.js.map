{"version":3,"sources":["../../src/app/services/TrackingService.ts"],"names":[],"mappings":"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","file":"TrackingService.js","sourcesContent":["/**\r\n * Created by hiepl on 6/24/2017.\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport {MyMarker, LocationObj} from \"../map/models/marker\";\r\nimport {Http, Response} from \"@angular/http\";\r\nimport 'rxjs/add/operator/toPromise';\r\nimport { Observable } from 'rxjs/Observable';\r\nimport 'rxjs/add/operator/catch';\r\nimport 'rxjs/add/operator/map';\r\nimport {Location} from \"../map/models/Location\";\r\n\r\n\r\n@Injectable()\r\nexport class TrackingService {\r\n    constructor (private http: Http) {}\r\n    lastPoint : any;\r\n    urlLocation: string = \"/tracking/get-locations\";\r\n    getLocations(url : string, lastPoint? : any, options? : any): Promise<any> {\r\n        //send to server in order to know which location that we returned\r\n        this.lastPoint = (lastPoint !== undefined && lastPoint != null) ? this.createTimeByString(lastPoint.last_point) : false;\r\n        let _this = this;\r\n        let opts = options ? options : {\"isRoadmap\":false};\r\n        let is_roadmap = opts.isRoadmap;\r\n        console.log(options, 'options');\r\n        let data = {\"options\":{\r\n            \"lastPoint\":lastPoint,\r\n            \"isRoadmap\":false\r\n        }};\r\n        if (is_roadmap) {\r\n            data[\"options\"]['isRoadmap'] = true;\r\n            data[\"options\"]['dateFrom'] = opts.dateFrom;\r\n            data[\"options\"]['dateTo'] = opts.dateTo;\r\n            data[\"options\"]['deviceId'] = opts.deviceId;\r\n            data[\"options\"]['nextLoc'] = opts.nextLoc ? opts.nextLoc : null;\r\n        } else {\r\n            data[\"options\"]['lastLocation'] = options.lastLocation !== undefined ? options.lastLocation : {};\r\n        }\r\n        return this.http.post(url, data).toPromise()\r\n            .then(function(value){\r\n                return _this.extractData(value);\r\n            })\r\n            .catch(this.handleError);\r\n    };\r\n    extractData(value: Response) {\r\n        let body = value.json();\r\n        let locationObject : LocationObj;\r\n        // console.log(this.lastPoint, 'this.lastPoint');\r\n        if ( body.status ) {\r\n            let markers = {};\r\n            for (let i = 0; i < body.data.length; i++) {\r\n                let temp = body.data[i];\r\n                let marker : MyMarker = {\r\n                    deviceId : temp.device_id,\r\n                    deviceNumber : temp.device_number,\r\n                    currentLocation : null,\r\n                    visible : true,\r\n                    isEdit : false,\r\n                    locations : []\r\n                };\r\n                let locs : Location[] = [];\r\n                for (let j = 0; j < temp.locations.length; j++) {\r\n                    let loc = temp.locations[j];\r\n                    let locTime = this.createTimeByString(loc.last_point);\r\n                    if (!this.lastPoint || locTime >= this.lastPoint) {\r\n                        let newLoc: Location = {\r\n                            lat: parseFloat(loc.lat),\r\n                            lng: parseFloat(loc.lng),\r\n                            state: loc.current_state !== undefined ? loc.current_state : '',\r\n                            status: loc.status,\r\n                            time: loc.created_at,\r\n                            time_original: loc.created_at_org,\r\n                            velocity: loc.velocity,\r\n                            headingClass: loc.heading,\r\n                            lastTime: loc.last_point\r\n                        };\r\n                        locs.push(newLoc);\r\n                    }\r\n                    if ( i === 0 && (!this.lastPoint || locTime >= this.lastPoint)) {\r\n                        marker.currentLocation = loc;\r\n                    }\r\n                };\r\n                marker.locations = locs;\r\n                markers[temp.device_id] = marker;\r\n            }\r\n            locationObject = {\r\n                markers : markers,\r\n                lastPoint : body.last_points,\r\n                hasMore : body.hasMore\r\n            };\r\n            return locationObject;\r\n        }\r\n        return [];\r\n    };\r\n    handleError() : void {};\r\n    createTimeByString(date : String) {\r\n        let lastTime = date.split('-');\r\n        let datetime = new Date();\r\n        if (lastTime.length > 0) {\r\n            var time_date = lastTime[2].split(' ');\r\n            var time_parts = time_date[1].split(':');\r\n            datetime.setFullYear(parseInt(lastTime[0], 10));\r\n            datetime.setMonth(parseInt(lastTime[1], 10) - 1);\r\n            datetime.setDate(parseInt(time_date[0], 10));\r\n\r\n            datetime.setHours(parseInt(time_parts[0], 10));\r\n            datetime.setMinutes(parseInt(time_parts[1], 10));\r\n            datetime.setSeconds(parseInt(time_parts[2], 10));\r\n        }\r\n        return datetime;\r\n    };\r\n    getUserProfile(): Promise<any> {\r\n        let _this = this;\r\n        return this.http.get('/user/profile').toPromise().then(function(value){\r\n            return _this.responseProfile(value);\r\n        }).catch(this.handleError);\r\n    };\r\n    responseProfile(value) {\r\n        let body = value.json();\r\n        if (body.status) {\r\n            return body.data;\r\n        }\r\n        return false;\r\n    }\r\n    saveUserProfile(data: any): Promise<any> {\r\n        let _this = this;\r\n        return this.http.post('/user/save-profile', data).toPromise().then(function(value){\r\n            return _this.responseProfile(value);\r\n        }).catch(this.handleError);\r\n    }\r\n}"],"sourceRoot":"/src"}